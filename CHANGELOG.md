# 更新日志

## [1.2.0] - 2025-08-04

### 新增功能

- 实现新的梯队系统，支持5个梯队配置
- 前4个梯队最多容纳3个作战单位
- 第5个梯队（预备队）不限制数量但不参与战斗
- 添加新的战斗梯队配置UI界面

### 技术实现

- 扩展Character类型，添加battleFormation字段
- 修改战斗逻辑以支持新的梯队系统
- 更新伤害计算逻辑以适应新的梯队系统
- 添加新的工具函数createDefaultBattleFormation

### 项目结构

- 更新类型定义文件，添加BattleFormation和FormationPosition接口
- 扩展常量配置文件，添加默认梯队配置
- 修改工具函数，添加新的梯队相关处理逻辑
- 更新UI组件，添加梯队配置界面

## [1.1.1] - 2025-08-04

### 技术改进

- 新增战斗逻辑测试用例，覆盖士兵系统和伤害穿透场景
- 优化角色类型定义，添加更详细的类型注释
- 改进伤害计算测试，增加边界条件测试用例
- 完善战斗日志类型检查，减少潜在的类型错误

### 问题修复

- 修复士兵造成伤害日志显示不正确的问题
- 修正战斗日志中敌人承受伤害与实际造成伤害不一致的情况
- 解决谁损失士兵显示不正确的问题（现在正确显示防御者损失士兵）
- 优化士兵承受伤害逻辑，提升游戏平衡性

## [1.1.0] - 2025-07-28

### 新增功能

- 实现士兵系统，角色可以携带士兵参与战斗
- 添加作战梯队切换功能，玩家可以在士兵在前和玩家在前之间切换
- 实现士兵伤害计算逻辑，士兵和玩家单独计算伤害
- 实现道具作用对象逻辑，根据作战梯队确定道具作用于士兵或玩家
- 实现士兵承受伤害后数量减少的机制
- 实现士兵死亡后伤害穿透到角色本身的逻辑

### 技术实现

- 扩展角色数据结构，添加士兵属性和作战梯队字段
- 修改战斗逻辑，支持士兵承受伤害和伤害穿透
- 更新道具系统，根据作战梯队确定道具作用对象
- 优化伤害计算系统，区分角色和士兵的伤害计算

### 项目结构

- 更新类型定义文件，添加士兵相关接口
- 扩展常量配置文件，添加默认士兵配置
- 修改工具函数，添加士兵相关处理逻辑
- 更新任务清单和需求文档，记录新增功能

### 已知问题

- 士兵造成伤害的日志显示仍有问题
- 战斗日志中敌人承受伤害与实际造成伤害有时不一致
- 士兵承受伤害的逻辑虽然已简化，但仍需进一步优化以确保游戏平衡性
- 谁损失士兵的显示不正确（应该是防御者损失士兵，而不是攻击者）

### 已处理问题

- 士兵死亡后伤害穿透到角色本身的逻辑已实现
- 士兵数量减少的计算已实现
- 道具作用对象逻辑已实现（根据作战梯队确定作用于士兵或玩家）
- 战斗顺序已优化：士兵先攻击，然后角色攻击，最后统计士兵损失
- 战斗日志显示已优化：攻击阶段显示伤害，回合结束时统一显示士兵损失
- 损失士兵为0时的日志显示问题已解决

## [1.0.0] - 2025-07-26

### 新增功能

- 实现三阶段回合制战斗系统（准备→战斗→结算）
- 添加角色系统，包括玩家和敌人角色
- 实现道具系统，支持治疗药水
- 创建战斗UI界面，包含角色面板、阶段指示器、操作面板和战斗日志
- 实现基本的游戏状态管理和战斗逻辑

### 技术实现

- 使用React + TypeScript + Vite构建项目
- 使用Tailwind CSS进行样式设计
- 使用Context API和useReducer进行状态管理
- 实现自定义Hooks来封装游戏逻辑
- 创建完整的类型定义系统

### 项目结构

- 建立了清晰的项目目录结构
- 实现了模块化的代码组织
- 配置了路径别名以简化导入
- 添加了完整的README文档

### 已知问题

- 敌人AI较为简单，仅能自动攻击
- 战斗动画效果有待增强
- 游戏平衡性需要进一步调整
